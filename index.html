<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVGFC - Alagang Gallegan Field Campaign</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,#E8F5E9 0%,#C8E6C9 100%);
    padding:20px;min-height:100vh
}
.container{max-width:1400px;margin:auto}
.header{
    background:linear-gradient(135deg,#1B5E20,#2E7D32);
    color:#fff;padding:40px;border-radius:16px;margin-bottom:30px;
    box-shadow:0 10px 30px rgba(27,94,32,.3);text-align:center
}
.header h1{font-size:36px;font-weight:700;margin-bottom:10px}
.header p{font-size:18px;color:#A5D6A7}
.stats-grid{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;margin-bottom:30px
}
.stat-card{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1);
    border-left:5px solid #1B5E20
}
.stat-number{font-size:48px;font-weight:700;color:#1B5E20}
.charts-grid{
    display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:30px
}
.chart-container{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1)
}
.chart-title{text-align:center;color:#1B5E20;margin-bottom:20px}
.full-width-chart{grid-column:1/-1}
.data-table{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1)
}
table{width:100%;border-collapse:collapse}
th{background:#1B5E20;color:#fff;padding:15px}
td{padding:12px;border-bottom:1px solid #E8F5E9}
.loading{text-align:center;font-size:18px;color:#1B5E20}
.error{background:#FFEBEE;color:#C62828;padding:20px;border-radius:12px}
.refresh-btn{
    position:fixed;bottom:30px;right:30px;
    background:#1B5E20;color:#fff;border:none;
    padding:15px 25px;border-radius:50px;
    cursor:pointer;font-weight:600
}
@media(max-width:968px){
    .charts-grid{grid-template-columns:1fr}
    .header h1{font-size:28px}
}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>Alagang Gallegan Field Campaign</h1>
<p>Manuel V. Gallego Foundation Colleges Inc.</p>
</div>

<div class="stats-grid" id="statsCards">
<div class="loading">Loading data...</div>
</div>

<div class="charts-grid">
<div class="chart-container">
<h3 class="chart-title">üìà Top Preferred Courses</h3>
<canvas id="barChart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">ü•ß Course Distribution</h3>
<canvas id="pieChart"></canvas>
</div>
</div>

<div class="chart-container full-width-chart">
<h3 class="chart-title">üí∞ Guardian's financial Stability</h3>
<canvas id="financialChart"></canvas>
</div>

<div class="chart-container full-width-chart">
<h3 class="chart-title">üè´ Top Feeder Schools</h3>
<canvas id="schoolChart"></canvas>
</div>

<div class="data-table">
<h3 class="chart-title">üìã Course Summary</h3>
<table id="courseTable">
<thead>
<tr><th>#</th><th>Course</th><th>Students</th><th>%</th></tr>
</thead>
<tbody>
<tr><td colspan="4" class="loading">Loading...</td></tr>
</tbody>
</table>
</div>

</div>

<button class="refresh-btn" onclick="loadData()">üîÑ Refresh</button>

<script>
const SHEET_ID = "1oMV99ucf5TpaPVA0eAd1mQq17fdQPVIN6JUDyLMI0YI";

const PRIORITY = [
"CRIMINOLOGY","EDUCATION","NURSING",
"BUSINESS ADMINISTRATION","INFORMATION TECHNOLOGY","INFORMATION SYSTEMS"
];

let barChart,pieChart,financialChart,schoolChart;
document.addEventListener("DOMContentLoaded",loadData);

async function loadData(){
try{
const res=await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`);
const txt=await res.text();
const json=JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
const rows=json.table.rows.map(r=>r.c.map(c=>c?c.v:""));
processData(rows);
}catch(e){
document.getElementById("statsCards").innerHTML=
`<div class="error">‚ùå Cannot load Google Sheet. Ensure it is public.</div>`;
}
}

function processData(rows){
const course={},finance={},school={};
rows.forEach(r=>{
let c=(r[2]||"").toUpperCase();
c=PRIORITY.some(p=>c.includes(p))?c:"OTHER";
course[c]=(course[c]||0)+1;
finance[r[10]||"Unknown"]=(finance[r[10]||"Unknown"]||0)+1;
school[(r[4]||"Unknown").toUpperCase()] = (school[(r[4]||"Unknown").toUpperCase()]||0)+1;
});
const sorted=Object.entries(course).sort((a,b)=>b[1]-a[1]);
renderStats(sorted,rows.length);
renderCharts(sorted,finance,school);
renderTable(sorted,rows.length);
}

function renderStats(sorted,total){
document.getElementById("statsCards").innerHTML=`
<div class="stat-card"><div class="stat-number">${total}</div>Total Students</div>
<div class="stat-card"><div class="stat-number">${sorted.length}</div>Preferred Courses</div>
<div class="stat-card"><div class="stat-number">${sorted[0][1]}</div>Top Course</div>
<div class="stat-card"><div class="stat-number">${((sorted[0][1]/total)*100).toFixed(1)}%</div>Top Share</div>`;
}

function renderCharts(course,finance,school){
barChart?.destroy();
barChart=new Chart(barChart=document.getElementById("barChart"),{
type:"bar",
data:{labels:course.slice(0,5).map(c=>c[0]),
datasets:[{data:course.slice(0,5).map(c=>c[1])}]}
});

pieChart?.destroy();
pieChart=new Chart(document.getElementById("pieChart"),{
type:"doughnut",
data:{labels:course.slice(0,5).map(c=>c[0]),
datasets:[{data:course.slice(0,5).map(c=>c[1])}]}
});

financialChart?.destroy();
financialChart=new Chart(document.getElementById("financialChart"),{
type:"bar",
data:{labels:Object.keys(finance),
datasets:[{data:Object.values(finance)}]},
options:{indexAxis:"y"}
});

schoolChart?.destroy();
const top=Object.entries(school).sort((a,b)=>b[1]-a[1]).slice(0,10);
schoolChart=new Chart(document.getElementById("schoolChart"),{
type:"bar",
data:{labels:top.map(s=>s[0]),
datasets:[{data:top.map(s=>s[1])}]},
options:{indexAxis:"y"}
});
}

function renderTable(data,total){
document.querySelector("#courseTable tbody").innerHTML=
data.map((c,i)=>`
<tr><td>${i+1}</td><td>${c[0]}</td><td>${c[1]}</td>
<td>${((c[1]/total)*100).toFixed(2)}%</td></tr>`).join("");
}
</script>

</body>
</html>

