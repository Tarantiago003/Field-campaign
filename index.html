<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MVGFC - Alagang Gallegan Field Campaign</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
    font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
    background:linear-gradient(135deg,#E8F5E9 0%,#C8E6C9 100%);
    padding:20px;min-height:100vh
}
.container{max-width:1400px;margin:auto}
.header{
    background:linear-gradient(135deg,#1B5E20,#2E7D32);
    color:#fff;padding:40px;border-radius:16px;margin-bottom:30px;
    box-shadow:0 10px 30px rgba(27,94,32,.3);text-align:center
}
.header h1{font-size:36px;font-weight:700;margin-bottom:10px}
.header p{font-size:18px;color:#A5D6A7}
.stats-grid{
    display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
    gap:20px;margin-bottom:30px
}
.stat-card{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1);
    border-left:5px solid #1B5E20;
    transition:transform .3s,box-shadow .3s
}
.stat-card:hover{
    transform:translateY(-5px);
    box-shadow:0 8px 25px rgba(27,94,32,.2)
}
.stat-icon{font-size:40px;margin-bottom:10px}
.stat-number{font-size:48px;font-weight:700;color:#1B5E20;margin-bottom:5px}
.stat-label{font-size:14px;color:#666;text-transform:uppercase;letter-spacing:1px}
.charts-grid{
    display:grid;grid-template-columns:2fr 1fr;gap:20px;margin-bottom:30px
}
.chart-container{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1)
}
.chart-title{
    text-align:center;color:#1B5E20;margin-bottom:20px;
    font-size:20px;font-weight:700
}
.full-width-chart{grid-column:1/-1}
.data-table{
    background:#fff;padding:30px;border-radius:16px;
    box-shadow:0 4px 15px rgba(0,0,0,.1)
}
table{width:100%;border-collapse:collapse}
th{
    background:linear-gradient(135deg,#1B5E20,#2E7D32);
    color:#fff;padding:15px;font-weight:600
}
td{padding:12px;border-bottom:1px solid #E8F5E9}
tr:hover{background:#F1F8E9}
.loading{text-align:center;font-size:18px;color:#1B5E20;padding:40px}
.error{background:#FFEBEE;color:#C62828;padding:20px;border-radius:12px;border-left:5px solid #C62828}
.refresh-btn{
    position:fixed;bottom:30px;right:30px;
    background:linear-gradient(135deg,#1B5E20,#2E7D32);
    color:#fff;border:none;
    padding:15px 25px;border-radius:50px;
    cursor:pointer;font-weight:600;
    box-shadow:0 4px 15px rgba(27,94,32,.4);
    transition:all .3s
}
.refresh-btn:hover{
    transform:translateY(-2px);
    box-shadow:0 6px 20px rgba(27,94,32,.5)
}
@media(max-width:968px){
    .charts-grid{grid-template-columns:1fr}
    .header h1{font-size:28px}
    .stat-number{font-size:36px}
}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>ğŸ“Š Alagang Gallegan Field Campaign</h1>
<p>Manuel V. Gallego Foundation Colleges Inc. - Student Analytics</p>
</div>

<div class="stats-grid" id="statsCards">
<div class="loading">Loading data...</div>
</div>

<div class="charts-grid">
<div class="chart-container">
<h3 class="chart-title">ğŸ“ˆ Top 5 Preferred Courses</h3>
<canvas id="barChart"></canvas>
</div>
<div class="chart-container">
<h3 class="chart-title">ğŸ¥§ Course Distribution</h3>
<canvas id="pieChart"></canvas>
</div>
</div>

<div class="chart-container full-width-chart">
<h3 class="chart-title">ğŸ’° Guardian's Financial Stability</h3>
<canvas id="financialChart"></canvas>
</div>

<div class="chart-container full-width-chart">
<h3 class="chart-title">ğŸ« Top 10 Feeder Schools</h3>
<canvas id="schoolChart"></canvas>
</div>

<div class="data-table">
<h3 class="chart-title">ğŸ“‹ Complete Course Summary</h3>
<table id="courseTable">
<thead>
<tr><th>Rank</th><th>Course Name</th><th>Total Students</th><th>Percentage</th></tr>
</thead>
<tbody>
<tr><td colspan="4" class="loading">Loading data...</td></tr>
</tbody>
</table>
</div>

</div>

<button class="refresh-btn" onclick="loadData()">ğŸ”„ Refresh Data</button>

<script>
const SHEET_ID = "1oMV99ucf5TpaPVA0eAd1mQq17fdQPVIN6JUDyLMI0YI";

const PRIORITY = [
"CRIMINOLOGY","EDUCATION","NURSING",
"BUSINESS ADMINISTRATION","INFORMATION TECHNOLOGY","INFORMATION SYSTEMS"
];

// Vibrant color palettes
const CHART_COLORS = {
    rainbow: ['#FF6B6B', '#4ECDC4', '#FFD93D', '#6C5CE7', '#A8E6CF'],
    schools: [
        '#1B5E20', '#2196F3', '#FF6B6B', '#4ECDC4', '#FFD93D',
        '#9B59B6', '#E74C3C', '#3498DB', '#F39C12', '#1ABC9C'
    ],
    financial: ['#FF6B6B', '#FFD93D', '#4ECDC4', '#A8E6CF']
};

let barChart,pieChart,financialChart,schoolChart;
document.addEventListener("DOMContentLoaded",loadData);

async function loadData(){
try{
const res=await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`);
const txt=await res.text();
const json=JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
const rows=json.table.rows.map(r=>r.c.map(c=>c?c.v:""));
processData(rows.slice(1)); // Skip header row
}catch(e){
document.getElementById("statsCards").innerHTML=
`<div class="error">âŒ Cannot load Google Sheet. Ensure the sheet is public and accessible.</div>`;
}
}

function processData(rows){
const course={},finance={},school={};
rows.forEach(r=>{
let c=(r[2]||"").trim().toUpperCase();
c=PRIORITY.some(p=>c.includes(p))?c:"OTHER";
course[c]=(course[c]||0)+1;

finance[r[10]||"Not Specified"]=(finance[r[10]||"Not Specified"]||0)+1;

let s=(r[4]||"Not Specified").trim().toUpperCase().replace(/\s+/g,' ');
school[s]=(school[s]||0)+1;
});

const sorted=Object.entries(course).sort((a,b)=>b[1]-a[1]);
renderStats(sorted,rows.length);
renderCharts(sorted,finance,school,rows.length);
renderTable(sorted,rows.length);
}

function renderStats(sorted,total){
const topCourse = sorted[0];
document.getElementById("statsCards").innerHTML=`
<div class="stat-card">
    <div class="stat-icon">ğŸ‘¥</div>
    <div class="stat-number">${total}</div>
    <div class="stat-label">Total Incoming Students</div>
</div>
<div class="stat-card">
    <div class="stat-icon">ğŸ“</div>
    <div class="stat-number">${sorted.length}</div>
    <div class="stat-label">Available Course Programs</div>
</div>
<div class="stat-card">
    <div class="stat-icon">ğŸ†</div>
    <div class="stat-number">${topCourse[1]}</div>
    <div class="stat-label">Students in ${topCourse[0]}</div>
</div>
<div class="stat-card">
    <div class="stat-icon">ğŸ“Š</div>
    <div class="stat-number">${((topCourse[1]/total)*100).toFixed(1)}%</div>
    <div class="stat-label">Most Popular Course Share</div>
</div>`;
}

function renderCharts(course,finance,school,total){
// Bar Chart - Top 5 Courses
barChart?.destroy();
const top5 = course.slice(0,5);
barChart=new Chart(document.getElementById("barChart"),{
    type:"bar",
    data:{
        labels:top5.map(c=>c[0]),
        datasets:[{
            label:'Number of Students',
            data:top5.map(c=>c[1]),
            backgroundColor:CHART_COLORS.rainbow,
            borderWidth:2,
            borderColor:'#fff'
        }]
    },
    options:{
        responsive:true,
        plugins:{
            legend:{display:false},
            tooltip:{
                callbacks:{
                    label:function(ctx){
                        const pct = ((ctx.raw/total)*100).toFixed(1);
                        return `${ctx.raw} students (${pct}%)`;
                    }
                }
            }
        },
        scales:{y:{beginAtZero:true}}
    }
});

// Pie Chart - Top 5 Courses
pieChart?.destroy();
pieChart=new Chart(document.getElementById("pieChart"),{
    type:"doughnut",
    data:{
        labels:top5.map(c=>c[0]),
        datasets:[{
            data:top5.map(c=>c[1]),
            backgroundColor:CHART_COLORS.rainbow,
            borderWidth:3,
            borderColor:'#fff'
        }]
    },
    options:{
        responsive:true,
        plugins:{
            legend:{
                position:'bottom',
                labels:{padding:15,font:{size:12}}
            },
            tooltip:{
                callbacks:{
                    label:function(ctx){
                        const pct = ((ctx.raw/total)*100).toFixed(1);
                        return `${ctx.label}: ${ctx.raw} (${pct}%)`;
                    }
                }
            }
        }
    }
});

// Financial Chart
financialChart?.destroy();
financialChart=new Chart(document.getElementById("financialChart"),{
    type:"bar",
    data:{
        labels:Object.keys(finance),
        datasets:[{
            label:'Number of Students',
            data:Object.values(finance),
            backgroundColor:CHART_COLORS.financial,
            borderWidth:2,
            borderColor:'#fff'
        }]
    },
    options:{
        indexAxis:"y",
        responsive:true,
        plugins:{legend:{display:false}}
    }
});

// School Chart - Top 10
schoolChart?.destroy();
const top10=Object.entries(school).sort((a,b)=>b[1]-a[1]).slice(0,10);
schoolChart=new Chart(document.getElementById("schoolChart"),{
    type:"bar",
    data:{
        labels:top10.map(s=>s[0]),
        datasets:[{
            label:'Number of Students',
            data:top10.map(s=>s[1]),
            backgroundColor:CHART_COLORS.schools
        }]
    },
    options:{
        indexAxis:"y",
        responsive:true,
        plugins:{legend:{display:false}}
    }
});
}

function renderTable(data,total){
document.querySelector("#courseTable tbody").innerHTML=
data.map((c,i)=>`
<tr>
    <td><strong>${i+1}</strong></td>
    <td><strong>${c[0]}</strong></td>
    <td>${c[1]}</td>
    <td><strong>${((c[1]/total)*100).toFixed(2)}%</strong></td>
</tr>`).join("");
}
</script>

</body>
</html>
